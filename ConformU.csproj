<Project Sdk="Microsoft.NET.Sdk.Web">

	<PropertyGroup Condition="'$(TargetFramework)'=='net6.0-windows'">
		<UseWindowsForms>true</UseWindowsForms>
		<DisableWinExeOutputInference>true</DisableWinExeOutputInference>
	</PropertyGroup>

	<PropertyGroup>
		<TargetFrameworks>net6.0-windows;net6.0</TargetFrameworks>
		<Configurations>Debug;Release</Configurations>
		<OutputType>Exe</OutputType>
		<UserSecretsId>c49fec0a-dd2c-4e60-9e85-407d8d9bdd9f</UserSecretsId>
		<Platforms>AnyCPU</Platforms>
		<ApplicationIcon>wwwroot\favicon.ico</ApplicationIcon>
		<AssemblyVersion>0.9.0</AssemblyVersion>
		<FileVersion>0.9.0</FileVersion>
		<SignAssembly>true</SignAssembly>
		<AssemblyOriginatorKeyFile>conformu.snk</AssemblyOriginatorKeyFile>
		<Version>0.9.0</Version>
		<AssemblyName>conformu</AssemblyName>
	</PropertyGroup>

	<!-- Added to support MacOS builds -->
	<PropertyGroup>
		<DefineConstants Condition=" '$(AppImage)' == 'true' ">$(DefineConstants);BUNDLED</DefineConstants>
		<DefineConstants Condition=" '$(MACOS)' == 'true' ">$(DefineConstants);BUNDLED;MACOS</DefineConstants>
	</PropertyGroup>

	<!--
  Keep for reference
  <PropertyGroup Condition="'$(Configuration)|$(TargetFramework)|$(Platform)'=='Release|net5.0|AnyCPU'">
    <NoWarn>1701;1702;MSB3042</NoWarn>
  </PropertyGroup>
      <RuntimeIdentifier>win10-x64</RuntimeIdentifier>
 -->

	<!-- Always ignore MSB3042 warning - Flags that Namespace/Class is inside a compiler conditional expression -->
	<PropertyGroup>
		<NoWarn>1701;1702;MSB3042;CS8002</NoWarn>
		<EnforceCodeStyleInBuild>True</EnforceCodeStyleInBuild>
		<AnalysisLevel>latest</AnalysisLevel>
		<PlatformTarget>AnyCPU</PlatformTarget>
	</PropertyGroup>
	<ItemGroup>
		<Compile Remove="publish\**" />
		<Content Remove="publish\**" />
		<EmbeddedResource Remove="publish\**" />
		<None Remove="publish\**" />
	</ItemGroup>
	<ItemGroup>
		<Compile Remove="Conform\IVideo.cs" />
	</ItemGroup>

	<ItemGroup>
		<EmbeddedResource Remove="Conform\Devices\Facades\DriverHostForm.resx" />
	</ItemGroup>

	<ItemGroup>
	  <_WebToolingArtifacts Remove="Properties\PublishProfiles\Arm64.pubxml" />
	</ItemGroup>

	<ItemGroup>
		<None Include="Conform\Devices\Facades\DriverHostForm.resx" />
		<None Include="Properties\PublishProfiles\Linux-Arm.pubxml.user" />
		<None Include="Properties\PublishProfiles\Linux-X64.pubxml.user" />
		<None Include="Properties\PublishProfiles\Windows.pubxml.user" />
	</ItemGroup>

	<ItemGroup>
		<PackageReference Include="ASCOM.Alpaca.Components" Version="1.0.50-beta" />
		<PackageReference Include="ASCOM.Com.Components" Version="1.0.50-beta" />
		<PackageReference Include="ASCOM.Exception.Library" Version="6.6.2-rc.1" />
		<PackageReference Include="ASCOM.Tools" Version="1.0.50-beta" />
		<PackageReference Include="Blazorise.Bootstrap" Version="1.1.2" />
		<PackageReference Include="Blazorise.Icons.FontAwesome" Version="1.1.2" />
		<PackageReference Include="Blazorise.TreeView" Version="1.1.2" />
		<PackageReference Include="CommandLineParser" Version="2.9.1" />
		<PackageReference Include="Octokit" Version="4.0.1" />
		<PackageReference Include="Radzen.Blazor" Version="4.2.3" />
		<PackageReference Include="Semver" Version="2.2.0" />
	</ItemGroup>

	<!-- Include the correct SOFA library depending on the targeted runtime OS -->
	<ItemGroup Condition="'$(RuntimeIdentifier)' == 'linux-x64'">
		<None Update="SofaLibraries\Linux64\libsofa_c.so">
			<Link>libsofa_c.so</Link>
			<CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
		</None>
	</ItemGroup>
	<ItemGroup Condition="'$(RuntimeIdentifier)' == 'linux-arm64'">
		<None Update="SofaLibraries\Arm64\libsofa_c.so">
			<Link>libsofa_c.so</Link>
			<CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
		</None>
	</ItemGroup>
	
	<Target Name="CustomAfterPublishh" AfterTargets="AfterPublish">
		<!-- Insert tasks to run after publish here -->
		<Message Text="After Publish Task $(CheckoutDirectory)" />

	</Target>

</Project>
